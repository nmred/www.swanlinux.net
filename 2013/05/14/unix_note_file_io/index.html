<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Title -->
    
    <title>
        
            文件IO | 
        
        Iodsp
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Nmred">
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",file io">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/iodsp.png">
    <link rel="icon" sizes="192x192" href="/img/iodsp.png">
    <link rel="apple-touch-icon" href="/img/iodsp.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Iodsp">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://www.swanlinux.net">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="文件IO | Iodsp">
    <meta property="og:image" content="http://www.swanlinux.net/img/iodsp.png" />
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="file io"> 

    
        <meta property="article:published_time" content="Tue May 14 2013 18:13:16 GMT+0800" />
        <meta property="article:modified_time" content="Wed Nov 15 2017 14:07:13 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="文件IO | Iodsp">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="http://www.swanlinux.net/img/iodsp.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://www.swanlinux.net" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html",
    "headline": "文件IO",
    "datePublished": "Tue May 14 2013 18:13:16 GMT+0800",
    "dateModified": "Wed Nov 15 2017 14:07:13 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Nmred",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": "Everything in order to facilitate"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Iodsp",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/iodsp.png"
        }
    },
    "keywords": ",file io",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                文件IO
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Nmred</strong>
        <span>5月 14, 2013</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAAC1ElEQVR42u3aUU4DMQwEUO5/aTgAapmxW1ElL1+oXWX90g9jO1/fV64vbGxsbGxsbGxs7I9kf8Xr9/N/vObBM492fr7PoxiSmLGxsbFvYLeA30Ekh9ICkjcWMWNjY2NfwH6etPJUNMPMPsljxsbGxsZ+TmqTzR8hBuUQNjY2NvaGnSSY9miSRIiNjY2NvW8q5UEkz8+GB//QS8PGxsb+eHY76P2Ev/9hvo2NjY39kex2tSOB2Q7fb1jY2NjYp7Lz9n3e9Gn3T474BSNkbGxs7AvYSQrZpJ92MNymwz8OGhsbG/to9mzTPHUlySb5dgbGxsbGPpvdjlrz0Nv20+Zd0c+AjY2NfTS7TVGvSjbtMKC9yomNjY19A7stGJJGf37dpy1R8oMe9tKwsbGxj2DnBUYeYjSIXZcxdS8NGxsb+zj2O4qEdszQljdFDNjY2NhHs1+VbDYtp2hYuxk2YGNjY1/D3jSSkmZ90QYKyoy8IMHGxsY+lb1p3Odlxqb8aMcVUVMJGxsb+zh2WwYksM1Vns3FnSKBYWNjYx/BTpJK0spph7VJIsybXNHPho2NjX0oO3992+hpRwJt8qsPBRsbG/tidvvK9grmDLa6fImNjY19AXuWKupQRk3/tuDBxsbGPpu9LxKSI9g395OhwnA8gI2NjX0cOylINkXF7ALQrOWEjY2NfQO7TS0JfjZCblNdXcBgY2NjX8BOtmiv8iRrv1uU6rCxsbEPZc+u4LTD3f3lns21TmxsbOyz2e3Ki40krPbJ2YgaGxsb+2z27N/9/BpN3gZqW1QvmIpgY2NjH8TetJlmh5iXELPjjiowbGxs7OPYbVhJc38W+oxXjwewsbGxr2TP8PkYYDYYGE5FsLGxsa9nvyP55e+qLxthY2NjX8DOm0p50Hmgm8S2KkWwsbGxj2C3rfzZJ23QeeqKEiE2Njb2oex7FjY2NjY2NjY2NvbHrB+eAsOm+/MR2QAAAABJRU5ErkJggg==">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/file-io/">file io</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=文件IO&url=http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html&pic=http://www.swanlinux.net/img/iodsp.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=文件IO&url=http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html&via=Nmred" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://www.swanlinux.net/2013/05/14/unix_note_file_io/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>###文件描述符</p>
<p>对于内核而言，所有打开的文件都通过文件描述符引用。文件描述符是一个非负整数。当打开一个现有文件或创建一个新文件时，内核向进程返回一个文件描述符。当读写一个文件时，使用 open 或 creat 返回的文件描述符表示该文件。将其作为参数传给 read 或 write.</p>
<p>按照惯例，UNIX 系统 shell使用文件描述符 0 与进程的标准输入相关联，文件描述符1与标准输出相关联，文件描述符2与标准出错输出相关联。</p>
<p>在依从POSIX的应用程序中，幻数 0，1，2应当替换成符号常量 STDIN_FILENO、STDOUT_FILENO、STDERR_FILENO,这些常量都定义在头文件<unistd.h>中。</unistd.h></p>
<p>###open 函数</p>
<p>调用open 函数可以打开或创建一个文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">int open(const char *pathname, int oflag, .../* mode_t mode*/);</span><br><span class="line">// 返回值：如果成功返回文件描述符，如果出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>pathname 是要打开或创建文件的名字。oflag 参数可用来说明函数的多个选项。用下列一个或多个常量进行 “或” 运算成 oflag 参数：</p>
<ul>
<li>O_RDONLY  只读打开</li>
<li>O_WRONLY  只写打开</li>
<li>O_RDWR    读、写打开</li>
</ul>
<p>在这三个常量中必须指定一个且只能指定一个。下列常量则是可选择的：</p>
<ul>
<li>O_APPEND  每次写时都追加到文件的尾端。</li>
<li>O_CREAT   若此文件不存在，则创建它。使用此选项时，需要第三个参数 mode. 用来其指定该新文件的访问权限位.</li>
<li>O_EXCL    如果同时指定了 O_CREAT , 而文件已经存在，则会出错。用此可以测试一个文件是否存在，如果不存在，则创建此文件，这使测试和创建两者成为一个原子操作。</li>
<li>O_TRUNC   如果此文件存在，而且为只写或读写成功打开，则将其长度截短为 0.</li>
<li>O_NOCTTY  如果 pathname 指的是终端设备，则不将该设备分配作为此进程的控制终端。</li>
<li>O_NONBLOCK 如果 pathname 指的是一个FIFO、一个块特殊文件或一个字符特殊文件，则此选项为文件的本次打开操作和后续的I/O操作设置非阻塞模式。</li>
</ul>
<p>下面三个标志也是可选的。它们是 Single Unix Specification 中同步输入和输出选项的一部分： \ </p>
<ul>
<li>O_DSYNC 使每次 write 等待物理I/O操作完成，但是写操作并不影响读取刚写入的数据，则不等待文件属性被更新. </li>
<li>O_RSYNC 使每一个以文件描述符作为参数的read操作等待，直至任何对文件同一部分进行的未决写操作都完成.</li>
<li>O_SYNC  使每次write都等到物理I/O操作完成，包括由write操作引起的文件属性更新所需的I/O. </li>
</ul>
<p><strong>O_DSYNC 和 O_SYNC 标志的区别：仅当文件属性需要更新以反映文件数据变化时，O_DSYNC标志仅影响文件属性，而设置 O_SYNC 标志后，数据和属性总是同步更新。</strong> </p>
<p>###creat 函数</p>
<p>也可以调用creat 函数创建一个新文件.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">int creat(const char *pathname, mode_t mode);</span><br><span class="line">//返回值：若成功则返回为只写打开的文件描述符，如果出错则返回 -1.</span><br><span class="line">注意，此函数等效于：</span><br><span class="line"></span><br><span class="line">open(pathname, O_WRONLY | O_CREAT | O_TRUNC, mode);</span><br></pre></td></tr></table></figure>
<p>###close 函数</p>
<p>可以调用close 函数关闭一个打开的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">int close(int filedes);</span><br><span class="line">// 返回值：若成功则返回0，若出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>关闭一个文件时还会释放加在该文件上的所有记录锁，当一个进程终止时，内核自动关闭它所有打开的文件。</p>
<p>###lseek 函数</p>
<p>可以调用 lseek 显式地为一个打开的文件设置其偏移量。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">off_t lseek(int filedes, off_t offset, int whence);</span><br><span class="line">// 返回值：如果成功返回新的文件偏移量，如果出错返回 -1</span><br></pre></td></tr></table></figure>
<p>对参数offset的解释与参数whence有关</p>
<ul>
<li>如果whence 是SEEK_SET,则将该文件的偏移量设置为距文件开始处offset个字节.</li>
<li>如果whence 是SEEK_CUR,则将该文件的偏移量为文件长度加offset，offset可为正或负.</li>
<li>如果whence 是SEEK_END,则将该文件的偏移量设置为文件长度加offset，offset可为正或负.</li>
</ul>
<p>这种方法也可用来确定所涉及的文件是否可以设置偏移量。如果文件描述符引用的是一个管道、FIFO或网络套接字，则lseek返回-1，并将errno设置为ESPIPE.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../apue.h&quot;</span><br><span class="line">  </span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	if (lseek(STDIN_FILENO, 0, SEEK_CUR) == -1) &#123;</span><br><span class="line">		printf(&quot;cantnot seek\n&quot;);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		printf(&quot;seek OK \n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通常，文件的当前偏移量应当是一个非负整数，但是，某些设备也可能允许负的偏移量。但对于普通文件，则其偏移量必须是非负值。因为偏移量可能是负值，所以在比较lseek的返回值时应当谨慎，不要测试它是否小于0，而要测试它是否等于 -1.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../apue.h&quot;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line"></span><br><span class="line">char buf1[] = &quot;abcdefghij&quot;;</span><br><span class="line">char buf2[] = &quot;ABCDEFGHIJ&quot;;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	int fd;</span><br><span class="line">	if ((fd = creat(&quot;file.hole&quot;, FILE_MODE)) &lt; 0) &#123;</span><br><span class="line">		err_sys(&quot;creat error&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (write(fd, buf1, 10) != 10) &#123;</span><br><span class="line">		err_sys(&quot;buf1 write error&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (lseek(fd, 16384, SEEK_SET) == -1) &#123;</span><br><span class="line">		err_sys(&quot;lseek error&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (write(fd, buf2, 10) != 10) &#123;</span><br><span class="line">		err_sys(&quot;buf2 write error&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###read 函数</p>
<p>调用read 函数从打开文件中读数据.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">ssize_t read(int filedes, void *buf, size_t nbytes);</span><br><span class="line">// 返回值：如果成功则返回读到的字节数，如果已到文件结尾则返回0，如果出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>有多种情况可使实际读到的字节数小于要求读的字节数:</p>
<ul>
<li>读普通文件时，在读到要求字节数之前已到了文件尾端。</li>
<li>当从终端设备读时，通常一次最多读一行。</li>
<li>当网络读时，网络中的缓存机构可能造成返回值小于所要求读的字节数.</li>
<li>当从管道或FIFO读时，如果管道包含的字节少于所需的数量，那么read将只返回实际可用的字节数。</li>
<li>当从某些面向记录的设备读时，一次最多返回一个记录。</li>
<li>当某个信号造成中断，而已经读了部分数据量时。</li>
</ul>
<p>###write 函数</p>
<p>调用write函数向打开的文件写数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">ssize_t write(int filedes, const void *buf, size_t nbytes);</span><br><span class="line">// 返回值：如果成功则返回已写的字节数,如果出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>####dup和dup2函数</p>
<p>下面两个函数都可用复制一个现存的文件描述符:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">int dup(int filedes);</span><br><span class="line">int dup2(int filedes, int filedes2);</span><br><span class="line">// 两个函数的返回值：如果成功则返回新的文件描述符，若出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>由dup返回的新文件描述符一定是当前可用文件描述符中的最小数值。用dup2则可以用filedes2 参数指定新描述符的数值。如果filedes2已经打开，则先将其关闭。如果filedes等于filedes2，则dup2返回filedes2，而不关闭它。</p>
<p>这些函数返回的新文件描述符与参数filedes共享一个文件表项。</p>
<p>复制一个描述符的另一种方法是使用fcntl函数，实际上调用： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	dup(filedes); </span><br><span class="line">等效于 </span><br><span class="line">	fcntl(filedes, F_DUPFD, 0);</span><br><span class="line">而调用 </span><br><span class="line">	dup2(filedes, filedes2);</span><br><span class="line">等效于 </span><br><span class="line">	close(filedes2);  </span><br><span class="line">	fcntl(filedes, F_DUPFD, filedes2);</span><br></pre></td></tr></table></figure>
<p>在后一种情况下，dup2并不完全等同于close加上fcntl.它们之间的区别是：</p>
<ul>
<li>dup2 是一个原子操作，而close及fcntl则包括两个函数调用。有可能在close 和 fcntl 之间插入执行信号捕获函数，它可能修改文件描述符。</li>
<li>dup2 和fcntl有某些不同的errno.</li>
</ul>
<p>###原子操作： pread 和 pwrite 函数</p>
<p>Single UNIX Specification 包括了XSI扩展，该扩展允许原子性地定位搜索(seek)和执行 I/O. pread 和 pwrite 就是这种扩展.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">ssize_t pread(int filedes, void *buf, size_t nbytes, off_t offset);</span><br><span class="line">// 返回值: 读到的字节数，如果已到文件结尾则返回0，如果出错则返回 -1</span><br><span class="line">ssize_t pwrite(int filedes, const void *buf, size_t nbytes, off_t offset);</span><br><span class="line">// 返回值：如果成功则返回已写的字节数，如果出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>调用pread相当于顺序调用lseek和read,但是pread又与这种顺序调用有下列重要区别：  </p>
<ul>
<li>调用 pread时，无法中断其定位和读操作。</li>
<li>不更新文件指针</li>
</ul>
<p>调用 pwrite 相当于顺序调用 lseek 和write ,但也与它们有类似的差别.</p>
<p>###sync、fsync、fdatasync 函数</p>
<p>传统的UNIX实现在内核中设有缓存区高速缓存和页面高速缓存，大多数的磁盘I/O都通过缓存进行，这种方式减少了磁盘的读写次数，但是降低了文件内容的更新速度，使得欲写到文件中的数据在一段时间内并没有写到磁盘上，当系统发生故障时，这种延时可能造成文件更新内容的丢失。为了保证磁盘上实际文件系统和缓存区高速缓存中内容的一致性，Unix系统提供了sync、fsync、fdatasync三个函数.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">int sync(int filedes);</span><br><span class="line"></span><br><span class="line">int fdatasync(int filedes);</span><br><span class="line"></span><br><span class="line">// 返回值：如果成功则返回0，如果出错则返回 -1</span><br><span class="line"></span><br><span class="line">void sync(void);</span><br></pre></td></tr></table></figure>
<p>sync 函数只是将所有修改过的块缓存区排入写队列，然后就返回，它并不等待实际写磁盘操作结束. </p>
<p>通常称为 update 的系统守护进程会周期性地(一般每隔30秒)调用sync函数，这就保证了定期冲洗内核的块缓存区。</p>
<p>fsync 函数只对由文件描述符filedes 指定的单一文件起作用，并且等待写磁盘操作结束，然后返回。fsync可用与数据库这样的应用程序，这种程序需要确保将修改过的块立即写到磁盘上。</p>
<p>fdatasync 函数类似与fsync,但它只影响文件的数据部分。而除数据外，fsync还会同步更新文件的属性.</p>
<p>###fcntl 函数</p>
<p>fcntl函数可以改变已打开的文件的性质：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">int fcntl(int filedes, int cmd, .../* int arg*/);</span><br><span class="line">// 返回值：如果成功则依赖cmd,如果出错则返回 -1</span><br></pre></td></tr></table></figure>
<p>本函数的第三个参数总是一个整数，与上面所示函数原型中的注释部分相对应，但是在说明记录锁时，第三个参数则是指向一个结构的指针。</p>
<p>fcntl 函数的5中的功能：</p>
<ul>
<li>复制一个现有的描述符 (cmd = F_DUPFD);</li>
<li>获得/设置文件描述符标记(cmd = F_GETFD 或 F_SETFD);</li>
<li>获得/设置文件状态(cmd = F_GETFL或 F_SETFL);</li>
<li>获得/设置异步I/O所有权(cmd = F_GETOWN 或 F_SETOWN);</li>
<li>获得/设置记录锁(cmd = F_GETLK 、F_SETLK 或 F_SETLKW);</li>
</ul>
<p>各个状态值详解:</p>
<ul>
<li>F_DUPFD 复制文件描述符filedes. 新文件描述符作为函数值返回。它是尚未打开的各描述符中大于或等于第三个参数值中各值的最小值。新描述符与filedes共享同一文件表项。但是，新描述符有自己的一套的文件描述符标记，其FD_CLOEXEC文件描述符被清除.</li>
<li>F_GETFD 对应于filedes的文件描述符标志作为函数值返回。当前只定义了一个文件描述符标志FD_CLOEXEC.</li>
<li>F_SETFD 对于filedes设置文件描述符标志。新标志按第三个参数设置.</li>
<li>F_GETFL 对应于filedes 的文件状态标志作为函数值返回。在说明open函数时，已说明了文件状态标志。不幸的是 <strong> 三个访问标志(O_RDONLY、O_WRONLY以及O_RDWR)并不是各占一位，因此首先必须用屏蔽字O_ACCMODE取得访问模式位，然后将结果与这三种值中的任一种做比较</strong> . </li>
<li>F_SETFL  将文件状态标志设置为第三个参数的值。可以更改的几个标记是：O_APPEND、O_NONBLOCK、O_SYNC、O_DSYNC、O_RSYNC、O_FSYNC和O_ASYNC.</li>
<li>F_GETOWN 取当前接收SIGIO和SIGURG信号的进程ID或进程组ID</li>
<li>F_SETOWN 设置接收SIGIO和SIGURG信号的进程ID或进程组ID</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../apue.h&quot;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int val;</span><br><span class="line"></span><br><span class="line">	if (argc != 2) &#123;</span><br><span class="line">		err_quit(&quot;usage: a.out &lt;descriptor#&gt;&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if ((val = fcntl(atoi(argv[1]), F_GETFL, 0)) &lt; 0) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(argv[1]));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	switch (val &amp; O_ACCMODE) &#123;</span><br><span class="line">		case O_RDONLY:</span><br><span class="line">			printf(&quot;read only&quot;);</span><br><span class="line">			break;</span><br><span class="line">		case O_WRONLY:</span><br><span class="line">			printf(&quot;write only&quot;);</span><br><span class="line">			break;</span><br><span class="line">		case O_RDWR:</span><br><span class="line">			printf(&quot;read write&quot;);</span><br><span class="line">			break;</span><br><span class="line">		default:</span><br><span class="line">			err_dump(&quot;unknown access mode&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (val &amp; O_APPEND) &#123;</span><br><span class="line">		printf(&quot;, append&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (val &amp; O_NONBLOCK) &#123;</span><br><span class="line">		printf(&quot;, nonblocking&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">#if defined(O_SYNC)</span><br><span class="line">	if (val &amp; O_SYNC) &#123;</span><br><span class="line">		printf(&quot;, synchronous writes&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">#endif</span><br><span class="line">#if !defined(_POSIX_C_SOURCE) &amp;&amp; defined(O_FSYNC)</span><br><span class="line">	if (val &amp; O_FSYNC) &#123;</span><br><span class="line">		printf(&quot;, synchronous writes&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">#endif</span><br><span class="line">	putchar(&apos;\n&apos;);</span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在修改文件描述符标志或文件状态时必须谨慎，先要取得现有的标志值，然后根据需要修改它，最后设置新标志值，不能只是执行F_SETFD或F_SETFL命令，这样会关闭以前设置的标志位.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;../apue.h&quot;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line"></span><br><span class="line">void get_fl(char *filename[]);</span><br><span class="line">void add_fl(char *filename[], int flags);</span><br><span class="line">void del_fl(char *filename[], int flags);</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;   </span><br><span class="line">	if (argc != 2) &#123;</span><br><span class="line">		err_quit(&quot;usage: a.out &lt;descriptor#&gt;&quot;);</span><br><span class="line">	&#125;   </span><br><span class="line"></span><br><span class="line">	get_fl(&amp;argv[1]);</span><br><span class="line">	add_fl(&amp;argv[1], O_APPEND);</span><br><span class="line">	get_fl(&amp;argv[1]);</span><br><span class="line">	del_fl(&amp;argv[1], O_APPEND);</span><br><span class="line">	get_fl(&amp;argv[1]);</span><br><span class="line">	exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void add_fl(char *filename[], int flags) </span><br><span class="line">&#123;   </span><br><span class="line">	int val;</span><br><span class="line">	if ((val = fcntl(atoi(*filename), F_GETFL, 0)) &lt; 0) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(*filename));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	val |= flags;</span><br><span class="line"></span><br><span class="line">	if (fcntl(atoi(*filename), F_SETFL, val)) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(*filename));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void del_fl(char *filename[], int flags)</span><br><span class="line">&#123;</span><br><span class="line">	int val;</span><br><span class="line">	if ((val = fcntl(atoi(*filename), F_GETFL, 0)) &lt; 0) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(*filename));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	val &amp;= ~flags;</span><br><span class="line"></span><br><span class="line">	if (fcntl(atoi(*filename), F_SETFL, val)) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(*filename));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void get_fl(char *filename[])</span><br><span class="line">&#123;</span><br><span class="line">	int val;</span><br><span class="line">	if ((val = fcntl(atoi(*filename), F_GETFL, 0)) &lt; 0) &#123;</span><br><span class="line">		err_sys(&quot;fcntl error for fd %d&quot;, atoi(*filename));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	switch (val &amp; O_ACCMODE) &#123;</span><br><span class="line">		case O_RDONLY:</span><br><span class="line">			printf(&quot;read only&quot;);</span><br><span class="line">			break;</span><br><span class="line">		case O_WRONLY:</span><br><span class="line">			printf(&quot;write only&quot;);</span><br><span class="line">			break;</span><br><span class="line">		case O_RDWR:</span><br><span class="line">			printf(&quot;read write&quot;);</span><br><span class="line">			break;</span><br><span class="line">		default:</span><br><span class="line">			err_dump(&quot;unknown access mode&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (val &amp; O_APPEND) &#123;</span><br><span class="line">		printf(&quot;, append&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (val &amp; O_NONBLOCK) &#123;</span><br><span class="line">		printf(&quot;, nonblocking&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">#if defined(O_SYNC)</span><br><span class="line">if (val &amp; O_SYNC) &#123;</span><br><span class="line">	printf(&quot;, synchronous writes&quot;);</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#if !defined(_POSIX_C_SOURCE) &amp;&amp; defined(O_FSYNC)</span><br><span class="line">	if (val &amp; O_FSYNC) &#123;</span><br><span class="line">		printf(&quot;, synchronous writes&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">#endif</span><br><span class="line">	putchar(&apos;\n&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2013/05/14/unix_note_file_state/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2013/05/14/unix_note_stanard_file_io/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="Nmred's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        nmred_2008@126.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/10/">十月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/09/">九月 2014<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/04/">四月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/03/">三月 2014<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/02/">二月 2014<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/09/">九月 2013<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/05/">五月 2013<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/02/">二月 2013<span class="sidebar_archives-count">20</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Adbase-文档/">Adbase 文档<span class="sidebar_archives-count">21</span></a></li><li><a class="sidebar_archives-link" href="/categories/C-语言/">C 语言<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/GNU-M4-技术文档/">GNU M4 技术文档<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/Hadoop/">Hadoop<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/SBT-快速入门/">SBT 快速入门<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">21</span></a></li><li><a class="sidebar_archives-link" href="/categories/php/">php<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/categories/《C-Primer-Plus-第6版-》练习/">《C++ Primer Plus(第6版)》练习<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/《unix-高级编程》-Note/">《unix 高级编程》-Note<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/《快学scala》练习/">《快学scala》练习<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/categories/虚拟技术/">虚拟技术<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/论文阅读/">论文阅读<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                时间轴
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">97</span>
            </a>
        </li>
        
            <li class="divider"></li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="https://weibo.com/nmred" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/nmred" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2013&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Iodsp
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
